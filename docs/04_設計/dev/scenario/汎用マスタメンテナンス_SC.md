# 汎用マスタメンテナンス

---

## 概要

汎用マスタメンテナンス機能は、システム内で利用される各種マスタデータをユーザーが直感的にメンテナンスできるようにするための機能です。  
マスタの構成や関連性が分からないユーザーでも、ガイドメッセージや画面案内に従って正しくデータを登録・更新・削除できます。

> **1機能に複数テーブルが密接に関連するケースにも対応**  
> 例：「商品マスタ」と「商品カテゴリマスタ」など、複数テーブルが機能単位で連動している場合も、関連テーブルをまとめて表示・編集・登録できます。

ルールマスタの編集は画面でSEモードを起動すると編集できる。

---

## 対象区分

- ユーザーシナリオ

---

## 関連資料

### Client

docs\04_設計\dev\client\汎用マスタメンテナンス_CL.md

### Server

docs\04_設計\dev\server\汎用マスタメンテナンス_SR.md

### Database



---

## ペルソナ

- マスタの構成が分からないユーザー

---

## ゴール

- ガイドメッセージに従い、マスタの構成が分からなくても正しく登録できる

---

## シナリオ

### 1. 画面表示

- 「汎用マスタメンテナンス」画面を開くと、利用可能なマスタ一覧が表示される
- 各マスタの概要説明や操作ガイドも表示される

### 2. 機能選択

- メンテナンスしたいマスタ（例：商品マスタ、顧客マスタなど）をプルダウンやリストから選択
- 選択時、**関連する複数のマスタテーブル（例：商品マスタ＋商品カテゴリマスタ等）の一覧と既存データが表示される**

### 3. データ編集

- 表示されたテーブルで以下の操作が可能
  - **行の追加**：新しいデータを1行単位で追加
  - **行の編集**：既存データの値を直接編集
  - **行の削除**：不要なデータ行を削除
- **複数テーブル間のリレーション（親子関係、外部キー制約など）も画面上で編集可能**
- 入力値のフォーマットや必須項目はリアルタイムでバリデーションされ、エラーがあれば即時メッセージ表示

### 4. 登録処理

- 編集完了後、「登録」ボタンを押下
- クライアント側で簡易バリデーション後、サーバーに変更内容を送信

### 5. サーバー処理・整合性チェック

- サーバー側でルールマスタに基づく整合性チェックやバリデーションを実施
- **複数テーブル間の整合性（例：親テーブルに存在しないデータが子テーブルに登録されていないか等）も自動チェック**
  - 問題なければデータベースに登録し、登録完了メッセージを返却
  - エラーがある場合はエラー内容を返却し、画面上に該当箇所のエラーメッセージを表示

### 6. 完了・再編集

- 登録完了時は「登録が完了しました」等のメッセージを表示し、最新データを再表示
- エラーがあった場合は、ユーザーが内容を修正し再度登録処理を行う

---

## 操作フロー詳細

1. 「汎用マスタメンテナンス」画面を開く
2. メンテナンス対象の機能（例：商品マスタ、顧客マスタなど）を選択
3. **選択した機能に紐づく複数のマスタテーブルの一覧が表示される**
4. 各テーブルのデータが一覧表示され、行の追加・編集・削除が可能
   - **複数テーブル間の関連付け（親子関係など）も画面上で編集可能**
5. 編集後、「登録」ボタンを押下
6. 入力内容のバリデーション・整合性チェックがサーバー側で実施される
   - **複数テーブル間のリレーションや整合性も自動チェック**
7. 問題なければデータが登録され、完了メッセージを表示
8. エラーがある場合は、該当箇所にエラーメッセージを表示し、ユーザーが修正できる

---

### システムジャーニー

| ステップ                       | 主体     | 概要・アクション                                                                                                   | 入力/出力 | 主な画面要素         | 備考                       |
|-------------------------------|----------|--------------------------------------------------------------------------------------------------------------------|-----------|----------------------|----------------------------|
| 画面を開く                    | ユーザー | 汎用マスタメンテナンス画面を開く                                                                                   | 出力      | 画面本体             |                            |
| 初期データ取得                | システム | 利用可能なマスタ一覧・概要・操作ガイドを取得し、画面に表示                                                          | 出力      | マスタ一覧、ガイド   |                            |
| ガイド・説明を確認            | ユーザー | 操作ガイドや説明を確認                                                                                             | 出力      | 操作ガイド           |                            |
| メンテナンス対象マスタを選択  | ユーザー | プルダウン等で対象マスタを選択                                                                                     | 入力      | プルダウン、リスト   |                            |
| 関連テーブル・データ取得      | システム | 選択したマスタに紐づく複数テーブルの定義・既存データを取得し、一覧表示                                             | 出力      | テーブル一覧         |                            |
| テーブル・カラム説明表示      | システム | 各テーブル・カラムの説明やリレーション情報を画面上に表示                                                           | 出力      | ヘルプ、ツールチップ |                            |
| 行追加・編集・削除            | ユーザー | データの追加・編集・削除をテーブル単位または複数テーブル横断で実施                                                 | 入力      | テーブル編集UI       |                            |
| リレーション編集              | ユーザー | 親子関係や外部キー等のリレーション情報を画面上で編集                                                               | 入力      | リレーションUI       |                            |
| 入力値バリデーション          | システム | 入力値の必須・型・フォーマット等をリアルタイムでチェックし、エラーがあれば即時メッセージ表示                        | 出力      | エラーメッセージ     |                            |
| 編集内容一時保存（任意）      | ユーザー | 編集途中の内容を一時保存（ドラフト保存）                                                                            | 入力      | 一時保存ボタン       | 任意操作                   |
| 登録ボタン押下                | ユーザー | 編集内容を確定し、登録ボタンを押下                                                                                  | 入力      | 登録ボタン           |                            |
| クライアント側バリデーション  | システム | クライアント側で簡易バリデーションを実施し、問題なければサーバーへ送信                                              | 出力      | エラーメッセージ     |                            |
| サーバーへ送信                | システム | 編集内容をサーバーへ送信                                                                                            | 入力      |                      |                            |
| サーバー整合性チェック        | システム | サーバー側でルールマスタに基づく整合性・リレーション・一意制約等のチェックを実施                                   | 出力      |                      |                            |
| テーブル間整合性チェック      | システム | 複数テーブル間の親子関係・外部キー・参照整合性等を自動チェック                                                     | 出力      |                      |                            |
| 競合チェック                  | システム | 他ユーザーによる同時編集・更新競合がないかチェック                                                                  | 出力      |                      |                            |
| エラー内容返却                | システム | エラーがあれば内容・該当箇所を返却し、画面上にエラーメッセージを表示                                               | 出力      | エラーメッセージ     |                            |
| エラー内容修正                | ユーザー | エラーメッセージを確認し、該当箇所を修正                                                                           | 入力      | テーブル編集UI       |                            |
| 再登録                        | ユーザー | 修正後、再度登録ボタンを押下                                                                                        | 入力      | 登録ボタン           |                            |
| 正常登録・完了メッセージ表示  | システム | 問題なければデータベースに登録し、登録完了メッセージを表示                                                          | 出力      | 完了メッセージ       |                            |
| 最新データ再取得・再表示      | システム | 最新データを取得し、画面に再表示                                                                                    | 出力      | テーブル一覧         |                            |
| 必要に応じて再編集            | ユーザー | 必要に応じて再度編集                                                                                               | 入力      | テーブル編集UI       |                            |

---

## 入出力項目一覧

### 入力項目

- 機能選択（プルダウン等）
- **複数マスタテーブルのデータ（行追加・編集・削除、リレーション編集）**
  - 各テーブルのカラム（例：コード、名称、有効/無効フラグ等）

### 出力項目

- 選択した機能に紐づく**複数の**マスタテーブルの一覧
- 各テーブルの既存データ
- バリデーションエラー・整合性エラー時のメッセージ
- 登録完了メッセージ

---

## FAQ・注意事項

- マスタの構成や関連性が分からない場合は、画面上のガイドやヘルプを参照してください
- **1機能に複数テーブルが密接に関連する場合も、関連テーブルをまとめて編集・登録できます**
- テーブル間の整合性ルールはルールマスタに従って自動チェックされます
- 編集中に他ユーザーが同じデータを更新した場合、競合エラーが発生する場合があります
- 誤ってデータを削除した場合、元に戻せない場合がありますのでご注意ください
- 入力値に不備がある場合は、エラーメッセージを確認し修正してください

---

## 編集履歴