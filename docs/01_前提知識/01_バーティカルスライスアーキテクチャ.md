# バーティカルスライスアーキテクチャ

---

## 概要

本ドキュメントは「バーティカルスライスアーキテクチャ」の学習資料である。

---

## バーティカルスライスアーキテクチャとは

バーティカルスライスアーキテクチャは、機能単位（スライス）でアプリケーションを分割する設計手法です。従来のレイヤードアーキテクチャ（プレゼンテーション層、ビジネスロジック層、データアクセス層など）とは異なり、1つの機能に必要なコード（UI、ドメイン、データアクセスなど）を1つのスライスとしてまとめます。

### レイヤードアーキテクチャとの比較

- **レイヤードアーキテクチャ**: 技術的関心ごと（UI、ビジネスロジック、データアクセス等）に層を分ける。機能追加時に複数層への変更が必要。
- **バーティカルスライスアーキテクチャ**: 機能ごとに必要な全てのコードを1つのスライスにまとめる。機能追加・変更が局所的。

### 適用例

- Webアプリケーションのエンドポイント単位（例：注文作成、ユーザー登録など）
- マイクロサービスやCQRSパターンとの組み合わせ

---

## 特徴

- 機能ごとにコードをまとめる（例：注文作成、ユーザー登録など）
- 各スライスは独立しており、他のスライスへの依存が少ない
- レイヤー横断的な設計（UI〜データアクセスまでを1スライスに集約）
- **自己完結性**: スライスごとに必要な依存関係やロジックを内包
- **ドメイン駆動設計（DDD）との親和性**: 境界づけられたコンテキスト単位での分割が容易

---

## メリット

- 機能追加・変更時の影響範囲が限定される（既存機能への影響が少ない）
- コードの見通しが良くなり、保守性が向上
- 小規模なチームやアジャイル開発に適している
- テスト容易性の向上（スライス単位でテスト可能）
- 機能単位でのリファクタリングや移植が容易

---

## デメリット

- 共通処理の重複が発生しやすい（例：バリデーションやロギング等）
- スライス間の一貫性維持が課題となる場合がある
- 大規模開発ではスライスの整理が必要（命名規則やディレクトリ構成の統一）
- 開発者ごとに設計や実装のばらつきが出やすい

---

## 実装例

- CQRS（Command Query Responsibility Segregation）パターンとの組み合わせ
- ASP.NET CoreのMediatRによるリクエスト/ハンドラ単位の実装
- 各スライスごとにController, Service, Repositoryなどを配置
- **Java/Spring Boot**: 機能単位でパッケージ分割し、REST Controller・Service・Repositoryをまとめる
- **Node.js/Express**: ルーティング単位でディレクトリを分割し、必要なロジックを集約

---

## 導入時の注意点

- スライスの粒度設計が重要（大きすぎても小さすぎても管理が難しい）
- 共通処理の整理方法（共通ライブラリ化やミドルウェアの活用など）を検討
- ドメイン知識に基づいたスライス分割（ビジネスロジックのまとまりを意識）
- コーディング規約やディレクトリ構成の統一
- スライス間の依存関係を最小限に抑える設計

---

## ユースケース例

- Webアプリケーションのエンドポイント単位での開発
- マイクロサービス内部の機能分割
- CQRSやイベントソーシングパターンとの組み合わせ
- 小規模〜中規模のプロジェクトでのアジャイル開発

---

## アンチパターン

- **スライスの肥大化**: 1スライスに多くの責務を詰め込みすぎてしまう
- **共通処理の乱立**: 各スライスで同じ処理を個別実装し、重複が増える
- **粒度の不統一**: スライスごとに粒度や設計方針がバラバラで保守性が低下

---

## 設計・運用のベストプラクティス

- スライスの粒度は「1ユースケース＝1スライス」を基本とする
- 共通処理はミドルウェアや共通ライブラリでまとめる
- スライス間の依存を最小限にし、自己完結性を重視する
- コーディング規約やディレクトリ構成を統一する
- テストはスライス単位で実施し、リグレッションを防ぐ

---

## 導入判断のポイント

- 機能追加・変更が頻繁に発生するか
- チームやプロジェクトの規模に適しているか
- ドメイン知識に基づいた分割ができるか
- 共通処理の整理や設計ルールの徹底が可能か

---

## 参考資料

- [Vertical Slice Architecture - Jimmy Bogard](https://jimmybogard.com/vertical-slice-architecture/)
- [バーティカルスライスアーキテクチャとは](https://zenn.dev/masayuki5160/articles/vertical-slice-architecture)
- [CQRSパターン](https://martinfowler.com/bliki/CQRS.html)
- [Vertical Slice Architecture in ASP.NET Core](https://codeopinion.com/vertical-slice-architecture-in-asp-net-core/)
- [ドメイン駆動設計とバーティカルスライス](https://qiita.com/masayuki5160/items/7e6e6e7b5e6e6e6e6e6e)